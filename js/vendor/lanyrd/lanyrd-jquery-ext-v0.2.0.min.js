/*  lanyrd.js - v0.2.0 
 *  Copyright 2011-2012, Dharmafly <http://dharmafly.com> 
 *  Released under the MIT License 
 *  More Information: https://github.com/dharmafly/lanyrd.js 
 */(function(a,b,c,d){function h(a){return Object.prototype.toString.call(a)==="[object Array]"}function i(a,b,c){var d=0,e=typeof a=="object"&&a.length,f;if(typeof e=="number")for(;d<e;d+=1)f=a[d],b.call(c||f,f,d,a);else for(d in a)a.hasOwnProperty(d)&&(f=a[d],b.call(c||f,f,d,a));return a}function j(a){return k(a,function(a,b){return b})}function k(a,b,c){var d=[];return i(a,function(a){d.push(b?b.apply(this,arguments):a)},c),d}function l(a,b,c){var d=[];return i(a,function(a){b.apply(this,arguments)&&d.push(a)},c),d}function m(a){var b=Array.prototype.slice.call(arguments,1),c=b.length,d=0,e,f;for(;d<c;d+=1){e=b[d];for(f in e)e.hasOwnProperty(f)&&(a[f]=e[f])}return a}function n(a,b){var c=[],d=[].slice.call(arguments,2);return i(a,function(a){c.push(a[b].apply(a,d))}),c}function o(a,b,c){var d=[].slice.call(arguments,2);return k(a,function(a){return u(a,b,c)})}function p(){return b&&b.Deferred?new b.Deferred:new f._.Deferred}function q(a){var c=arguments.length===1&&h(a)?a:arguments;return b&&b.Deferred?b.when.apply(b,c):f._.when.apply(f._,c)}function r(a){var b=e.requestType,c=s(a,b),d=f.deferred(),g=d.promise({data:null,type:b,xhr:b===f.request.JSONP?null:c});return c.then(function(a){g.data=a,d[!a||a.error?"reject":"resolve"](g)},function(){d.reject(g)}),g}function s(a,c){return c=c||"json",b?b.ajax({url:a,dataType:c}):f[c](a)}function t(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}function u(a,b,c,e){var f=(b||"").split("."),g;if(!b)return a;while(a&&f.length){g=f.shift();if(!(a.hasOwnProperty(g)||e===!0&&a[g]!==d))break;a=a[g];if(f.length===0&&a!==d)return a}return arguments.length>2?c:null}function v(a){return f.a.href=a||"/",f.a.pathname}function w(a){a=h(a)?a:[a];for(var b=0,c=a.length,d;b<c;b+=1){d=a[b];if(d instanceof w||d instanceof y)d=d.get();this[b]=d}this.length=a.length}function y(a){a=a||{},this.url=a.url,this.data=a.data||{};var b=a.deferred||f.deferred();this.url&&(this.fetch=function(a,c){if(this.state()!==y.PENDING)return this;var d=this.url,g,h;return e.requestType===f.request.JSONP&&(d+=(d.indexOf("?")<0?"?":"&")+"callback=?"),g=f.request(d),h=this,g.done(function(){h.data=g.data,b.resolveWith(h,[h,g])}),g.fail(function(){b.rejectWith(h,[h,g])}),this.then(a,c)}),b.promise(this)}"use strict";var e,f,g;r.JSON="json",r.JSONP="jsonp",w.prototype={constructor:w,get:function(a,b){return u(this[0],a,b)},escape:function(a,b){return t(this.get(a,b))},related:function(a){var b=a.split("."),c=b.pop(),d;return b.push("api_urls"),d=this.get(b.join("."),{})[c],d||(d=this.get(a)),d?new y({url:d}):y.noop()},fetchRelated:function(a,b,c){return this.related(a).fetch(b,c)},fetchAllRelated:function(a,c,d){function g(b){return b.fetchRelated(a)}var e=f.deferred();return b.when.apply(b,this.map(g)).then(function(){var a=[],c=[];b.each(arguments,function(){c.push(this[1]),a.push(this[0])}),e.resolve(a,c)},e.reject),e.promise().then(c,d)},at:function(a){return a=a<0?a+this.length:a,this[a]||null}};var x={each:i,map:k,pluck:o,filter:l,invoke:n};i(x,function(a,b){w.prototype[b]=function(){return x[b].apply(this,[].concat.apply(this,arguments))}}),y.PREV="prev",y.NEXT="next",y.RESOLVED="resolved",y.REJECTED="rejected",y.PENDING="pending",y.noop=function(a){var b=f.deferred(),c=new y(m({deferred:b},a));return b.rejectWith(c,[c,null]),c},y.prototype={constructor:y,url:null,data:null,fetch:function(){return this},fetched:function(){return this.state&&this.state()===y.RESOLVED},related:function(a){return this.collection().related(a)},get:function(a,b){return u(this.data,a,b)},escape:function(a,b){return t(this.get(a,b))},collection:function(a){var b=this.get(a);return b&&(b=new w(b)),b},paginate:function(a){var b=this.get("pagination.api_urls",{})[a];return b?new y({url:b}):y.noop()},paginated:function(){return this.get("pagination.num_pages",1)>1},first:function(){return this.get("pagination.page",1)===1},last:function(){var a=this.get("pagination",{});return a.page===a.num_pages},next:function(a,b){return this.paginate(y.NEXT).fetch().then(a,b)},prev:function(a,b){return this.paginate(y.PREV).fetch().then(a,b)},all:function(a,b){function g(){function g(c,g){f-=1;if(f)return;g?d.rejectWith(e,[e,g]):(e.data={},e.data[a]=b,d.resolveWith(e,[e]))}var a=c.get("pagination.paginated_key"),b=[],f=2;(function h(c){return c.flag||(c.flag=!0,d.notifyWith(c,arguments),b=c.get(a).slice().concat(b)),c.prev().then(h,g)})(c),function i(c){return c.flag||(c.flag=!0,d.notifyWith(c,arguments),b=b.concat(c.get(a))),c.next().then(i,g)}(c)}var c=this,d=f.deferred(),e=new y({deferred:d});return this.fetched()?g():this.fetch().always(g),e.then(a,b)}},f={API_DOMAIN:"http://lanyrd.asyncjs.com",conference:function(a){return this.resource({url:this.url(a)})},person:function(a){var b=this.url(a).replace(/\/profile\//i,"/people/");return this.resource({url:b})},place:function(a){return this.resource({url:this.url(a)})},topic:function(a){return this.resource({url:this.url(a)})},collection:function(a){return new w(a)},resource:function(a){return new y(a)},url:function(a){return this.API_DOMAIN+v(a)},config:function(a){m(e,a)},noConflict:function(){return c.lanyrd=a,f},Collection:w,Resource:y,a:c.document&&c.document.createElement("a"),isArray:h,each:i,keys:j,map:k,filter:l,extend:m,invoke:n,pluck:o,deferred:p,when:q,request:r,escape:t,keypath:u,pathname:v},e={requestType:r.JSONP},typeof c.define=="function"&&c.define.amd?c.define("lanyrd",function(){return f}):c.exports?(require("./lanyrd/deferred")(f),require("./lanyrd/request")(f),g=require("url").parse,f.pathname=function(a){return g(a).pathname},e.requestType=r.JSON,c.exports=f):c.lanyrd=f})(this.lanyrd,this.jQuery,typeof module!="undefined"?module:this),function(a){function c(a){var c={url:a,selector:"h4 a.summary.url",extract:["href"]},d="http://dharmafly.noodle.jit.su?q="+encodeURIComponent(JSON.stringify(c))+"&callback=?";return b(d)}"use strict";var b=a.jsonp||window.jQuery&&window.jQuery.getJSON;if(a.series)return;a.series=function(b,d,e){var f=[];return c(b).pipe(function(b){var c=new a.deferred,d=c.promise();return b[0].error||b[0].results.length==0?c.reject(b[0]):c.resolve(b[0]),d}).pipe(function(b){return a.each(b.results,function(b){f.push(a.conference("http://lanyrd.com"+b.href).fetch())}),a.when(f)}).done(d).fail(e)}}(this.lanyrd),function(a){"use strict",a.widgets={people:{},person:{}};var b=function(){var a=/{{\s*([a-z0-9_][\\.a-z0-9_]*)\s*}}/gi;return function(b,c){return b.replace(a,function(a,b){for(var d=b.split("."),e=d.length,f=c,h=0;h<e;h++){f=f[d[h]];if(f===void 0)throw"tim: '"+d[h]+"' not found in "+a;if(h===e-1)return f}})}}();a.widgets.people=function(c,d,e){function g(d,f){function n(a,c){var d="",e=0;for(e;e<a.length;e++)d+=b(m,a[e].user);return b(l,{list:d,people_type:c})}var g=new a.deferred,h=g.promise(),i="",j=e.templates.attendeesHeading||'<h2 class="lanyrd-attendees-title"><a target="_blank" href={{attendees_url}}>{{amount}} attending</a></h2>',k=e.templates.trackersHeading||'<h2 class="lanyrd-trackers-title">{{amount}} tracking</h2>',l=e.templates.people||'<ul class="lanyrd-people {{people_type}}">{{list}}</ul>',m=e.templates.person||'<li><a href="{{web_url}}"><img class="lanyrd-avatar" title="{{name}} ({{username}})" src="{{avatar_url}}"></a></li>';return i+='<div class="lanyrd-widget lanyrd-widget-people"><style>.lanyrd-people, .lanyrd-people li {padding: 0;margin: 0;}.lanyrd-people, .lanyrd-people li {overflow: hidden;}.lanyrd-people li {list-style: none;float: left;padding-right: 6px;}.lanyrd-people li img.lanyrd-avatar {width: 46px; height: 46px;border: 2px solid white;}</style>',i+=b(j,{attendees_url:c[0]+"attendees",amount:d.length}),i+=n(d,"attendees"),i+=b(k,{amount:f.length}),i+=n(f,"trackers"),i+="</div>",g.resolve(i),h}var f,e=e||{};return e.all=e.all||!1,e.templates=e.templates||(e.templates={}),c=a.isArray(c)?c:[c],f=a.map(c,function(b){return a.conference(b).fetch()}),a.when(f).pipe(function(){return f.length>1?a.mergeRelated(f,{related:["attendees","trackers"]}):e.all?a.when(f[0].related("conference.attendees").all(),f[0].related("conference.trackers").all()):a.when(f[0].related("conference.attendees").fetch(),f[0].related("conference.trackers").fetch())}).pipe(function(b,c){return b.attendees?g(a.map(b.attendees,function(a){return{user:a}}),a.map(b.trackers,function(a){return{user:a}})):(b=e.all?b:b[0],c=e.all?c:c[0],g(b.data.attendees,c.data.trackers))}).then(function(a){d&&(d.innerHTML=e.append?d.innerHTML+=a:a)})},a.widgets.people.topics=function(a,b,c){},a.widgets.person=function(c,d,e){function f(c){var d=a.deferred(),f=d.promise(),g,h=e.templates.person||'<h2><a href="{{web_url}}">{{name}}</a></h2><img class="lanyrd-avatar" title="{{name}} ({{username}})" src="{{avatar_url}}"><p>{{short_bio}}</p>';return g=b(h,c),g='<div class="layrd-widget lanyrd-widget-person">'+g+"</div>",d.resolve(g),f}var e=e||{};return e.templates||(e.templates={}),a.person(c).fetch().pipe(function(a){return a.get("user")}).pipe(f).then(function(a){d&&(d.innerHTML=e.append?d.innerHTML+=a:a)})},a.widgets.person.topics=function(c,d,e){function h(c){var d=new a.deferred,f=d.promise(),g=[],h="",i;a.each(c,function(b,d){a.each(e.ignore,function(a){d.toLowerCase()===a.toLowerCase()&&delete c[d]})}),a.each(c,function(a,b){a>=e.cutoff&&g.push([b,a])}),g=g.sort(function(a,b){return b[1]-a[1]}).slice(0,e.amount),g=a.map(g,function(a){return a[0]});for(i=0;i<g.length;i++)h+=b(e.templates.topic||"<li>{{topic}}</li>",{topic:g[i]});return d.resolve(b(e.templates.topics||'<div class="lanyrd-widget lanyrd-widget-person-topics"><ol>{{topics}}</ol></div>',{topics:h}),c),f}var f=a.person(c),g=[],e=e||{};return e.templates||(e.templates={}),e.amount=e.amount||10,e.ignore=e.ignore||[],e.cutoff=e.cutoff||0,e.append=e.append||!1,e.events=e.events,f.fetch().pipe(function(a){if(!e.events)return a.related("user.attending").fetch()}).pipe(function(b){var c=a.map(b.get("conferences_attending"),function(b){return a.resource({url:b.api_urls.conference})});return a.topics(c)}).pipe(function(a){return h(a).then(function(a){d&&(d.innerHTML=e.append?d.innerHTML+=a:a)})})},a.widgets.series=function(c,d,e){function g(c){var d=new a.deferred,f=d.promise(),g="",h=new Date,i={upcoming:[],past:[]};e.amount>0&&(c=c.slice(0,e.amount)),c.length===0&&(g+="<h2>no events found for the series</h2>"),a.each(c,function(a,c){a.conference.end_date+"T23:59:59.000Z">(new Date).toISOString()?i.upcoming.push(b(e.templates.upcomingConference||'<li><a href="{{web_url}}">{{name}}</a></li>',a.conference)):i.past.push(b(e.templates.pastConference||'<li><a href="{{web_url}}">{{name}}</a></li>',a.conference))});if(e.conferences.upcoming){var j=[];for(var k=i.upcoming.length-1;k>=0;k--)j.push(i.upcoming[k]);g+=b(e.templates.upcoming||'<div class="upcoming conferences"><h1>Upcoming Events</h1><ul>{{conferences}}</ul></div>',{conferences:j.join("")})}return e.conferences.past&&(g+=b(e.templates.past||'<div class="past conferences"><h1>Past Events</h1><ul>{{conferences}}</ul></div>',{conferences:i.past.join("")})),d.resolve(b(e.templates.wrapper||'<div class="lanyrd-widget lanyrd-widget-series">{{content}}</div>',{content:g}),c),f}if(!a.series)throw"Lanyrd series extension isn't loaded!";var f=a.series(c),e=e||{};return e.templates||(e.templates={}),e.conferences||(e.conferences={}),e.amount=e.amount||0,e.append=e.append||!1,e.conferences.upcoming=e.conferences.upcoming||!0,e.conferences.past=e.conferences.past||!0,f.pipe(function(){var b=a.map(arguments,function(a){return a&&a.length&&a[0].data});return g(b).then(function(a){d&&(d.innerHTML=e.append?d.innerHTML+=a:a)})}).fail(function(){var a=e.templates.error||'<div class="lanyrd-widget-series lanyrd-widget-error">Widget error!</div>';d&&(d.innerHTML=e.append?d.innerHTML+=a:a)})},a.widgets.series.topics=function(c,d,e){function f(c){var d=new a.deferred,f=d.promise(),g=[],h="",i;a.each(c,function(b,d){a.each(e.ignore,function(a){d.toLowerCase()===a.toLowerCase()&&delete c[d]})}),a.each(c,function(a,b){a>=e.cutoff&&g.push([b,a])}),g=g.sort(function(a,b){return b[1]-a[1]}).slice(0,e.amount),g=a.map(g,function(a){return a[0]});for(i=0;i<g.length;i++)h+=b(e.templates.topic||"<li>{{topic}}</li>",{topic:g[i]});return d.resolve(b(e.templates.topics||'<div class="lanyrd-widget lanyrd-widget-series-topic"><ol class="lanyrd-widget lanyrd-widget-series-topic">{{topics}}</ol></div>',{topics:h}),c),f}var e=e||{};return e.templates||(e.templates={}),e.append=e.append||!1,e.amount=e.amount||10,e.ignore=e.ignore||[],e.cutoff=e.cutoff||0,a.series(c).pipe(function(){return a.map(arguments,function(a){return a[0]})}).pipe(a.topics).pipe(function(a){return f(a).then(function(a){d&&(d.innerHTML=e.append?d.innerHTML+=a:a)})})}}(lanyrd),function(a){function e(a,b){for(var c=0,d=a.length;c<d;c+=1)return a[c]===b?!0:!1}"use strict";var b=["staff","speakers","attendees","trackers"],c={staff:4,speakers:4,attendees:2,trackers:1},d=0;a.mergeRelated=function(f,g){function k(){var b=[],c=a.keys(j);return a.each(arguments,function(d){var e=a.map(c,function(a){return d[0].collection("conference").related(a).fetch().pipe(function(a){return a.get(a.get("pagination.paginated_key"))})});b=b.concat(e)}),a.when.apply(null,b).pipe(function(){var b=[],e={};return a.each(arguments,function(f,g){var h=g%c.length;e[c[h]]=a.map(f,function(a){return a.user?a.user:(delete a.user,a.username||(a.username="user-"+(d+=1)),a)}),h===c.length-1&&(b.push(e),e={})}),b})}function l(c){function k(a,b){return g.duplicateAttendee!==!1&&a==="attendees"&&e(b,d[a])}function l(a,b){var c=h[b.username];c||(c=h[b.username]=b),d[a]||(d[a]=[]);if(!f[c.username]||k(a,c))d[a].push(c),f[c.username]=a;c.score=c.score||0,c.score+=j[a]}var d={},f={},h={};return a.each(b,function(b){j[b]&&a.each(c,function(c){var d=c[b];a.each(d,function(a){l(b,a)})})}),a.invoke(d,"sort",i),d}var h,i,j;return g=g||{},h=a.map(f,function(a){return a.fetch()}),j=g.related||c,a.isArray(g.related)&&(j={},a.each(g.related,function(a){j[a]=c[a]})),i=g.comparator||function(a,b){return a.score===b.score?a.username>b.username?1:-1:a.score>b.score?-1:1},a.when.apply(null,h).pipe(k).pipe(l)}}(this.lanyrd),function(a){function b(){function e(a){d[a.name]?d[a.name]++:d[a.name]=1}var b=new a.deferred,c=b.promise(),d={};return a.isArray(arguments[0])?a.each(arguments,function(b){a.each(b[0].get("conference.topics"),e)}):a.each(arguments[0].get("conference.topics"),e),b.resolve(d),c}"use strict",a.topics=function(d){return d=a.isArray(d)?d:[d],d=a.map(d,function(a){return a.fetched()?a:a.fetch()}),a.when(d).pipe(b)}}(lanyrd);