/*  lanyrd.js - v0.0.1 
 *  Copyright 2011-2012, Dharmafly <http://dharmafly.com> 
 *  Released under the MIT License 
 *  More Information: https://github.com/dharmafly/lanyrd.js 
 */(function(a,b,c,d){function i(a){a=f.isArray(a)?a:[a];for(var b=0,c=a.length,d;b<c;b+=1){d=a[b];if(d instanceof i||d instanceof j)d=d.get();this[b]=d}this.length=a.length}function j(a){a=a||{},this.url=a.url,this.data=a.data||{};var b=a.deferred||f.deferred();this.url&&(this.fetch=function(a,c){if(this.state()!==j.PENDING)return this;var d=this.url,g,h;return e.requestType===f.request.JSONP&&(d+=(d.indexOf("?")<0?"?":"&")+"callback=?"),g=f.request(d),h=this,g.done(function(){h.data=g.data,b.resolveWith(h,[h,g])}),g.fail(function(){b.rejectWith(h,[h,g])}),this.then(a,c)}),b.promise(this)}"use strict";var e,f,g,h;f={a:c.document&&c.document.createElement("a"),isArray:function(a){return Object.prototype.toString.call(a)==="[object Array]"},each:function(a,b,c){var d=0,e=typeof a=="object"&&a.length,f;if(typeof e=="number")for(;d<e;d+=1)f=a[d],b.call(c||f,f,d,a);else for(d in a)a.hasOwnProperty(d)&&(f=a[d],b.call(c||f,f,d,a));return a},keys:function(a){return f.map(a,function(a,b){return b})},map:function(a,b,c){var d=[];return f.each(a,function(a){d.push(b?b.apply(this,arguments):a)},c),d},filter:function(a,b,c){var d=[];return f.each(a,function(a){b.apply(this,arguments)&&d.push(a)},c),d},extend:function(a){var b=arguments[0],c=Array.prototype.slice.call(arguments,1),d=c.length,e=0,f,g;for(;e<d;e+=1){f=c[e];for(g in f)f.hasOwnProperty(g)&&(b[g]=f[g])}return b},invoke:function(a,b){var c=[],d=[].slice.call(arguments,2);return f.each(a,function(a){c.push(a[b].apply(a,d))}),c},pluck:function(a,b,c){var d=[].slice.call(arguments,2);return f.map(a,function(a){return f.keypath(a,b,c)})},deferred:function(){return b&&b.Deferred?new b.Deferred:new f._.Deferred},when:function(a){var c=arguments.length===1&&f.isArray(a)?a:arguments;return b&&b.Deferred?b.when.apply(b,c):f._.when.apply(f._,c)},request:function(a){var b=e.requestType,c=f.rawRequest(a,b),d=f.deferred(),g=d.promise({data:null,type:b,xhr:b===f.request.JSONP?null:c});return c.then(function(a){g.data=a,d[!a||a.error?"reject":"resolve"](g)},function(){d.reject(g)}),g},rawRequest:function(a,c){return c=c||"json",b?b.ajax({url:a,dataType:c}):g.utils[c](a)},escape:function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},keypath:function(b,c,e,f){var g=(c||"").split("."),h;if(!c)return b;while(b&&g.length){h=g.shift();if(!(b.hasOwnProperty(h)||f===!0&&b[h]!==d))break;b=b[h];if(g.length===0&&b!==d)return b}return arguments.length>2?e:null},pathname:function(a){return f.a.href=a||"/",f.a.pathname}},f.request.JSON="json",f.request.JSONP="jsonp",i.prototype={constructor:i,get:function(a,b){return f.keypath(this[0],a,b)},escape:function(a,b){return f.escape(this.get(a,b))},related:function(a){var b=a.split("."),c=b.pop(),d;return b.push("api_urls"),d=this.get(b.join("."),{})[c],d||(d=this.get(a)),d?new j({url:d}):j.noop()},fetchRelated:function(a,b,c){return this.related(a).fetch(b,c)},fetchAllRelated:function(a,c,d){function g(b){return b.fetchRelated(a)}var e=f.deferred();return b.when.apply(b,this.map(g)).then(function(){var a=[],c=[];b.each(arguments,function(){c.push(this[1]),a.push(this[0])}),e.resolve(a,c)},e.reject),e.promise().then(c,d)},at:function(a){return a=a<0?a+this.length:a,this[a]||null}},f.each(["each","map","filter","pluck","invoke"],function(a){i.prototype[a]=function(){return f[a].apply(this,[].concat.apply(this,arguments))}}),j.PREV="prev",j.NEXT="next",j.RESOLVED="resolved",j.REJECTED="rejected",j.PENDING="pending",j.noop=function(a){var b=f.deferred(),c=new j(f.extend({deferred:b},a));return b.rejectWith(c,[c,null]),c},j.prototype={constructor:j,url:null,data:null,fetch:function(){return this},fetched:function(){return this.state&&this.state()===j.RESOLVED},related:function(a){return this.collection().related(a)},get:function(a,b){return f.keypath(this.data,a,b)},escape:function(a,b){return f.escape(this.get(a,b))},collection:function(a){var b=this.get(a);return b&&(b=new i(b)),b},paginate:function(a){var b=this.get("pagination.api_urls",{})[a];return b?new j({url:b}):j.noop()},paginated:function(){return this.get("pagination.num_pages",1)>1},first:function(){return this.get("pagination.page",1)===1},last:function(){var a=this.get("pagination",{});return a.page===a.num_pages},next:function(a,b){return this.paginate(j.NEXT).fetch().then(a,b)},prev:function(a,b){return this.paginate(j.PREV).fetch().then(a,b)},all:function(a,b){function g(){function g(c,g){f-=1;if(f)return;g?d.rejectWith(e,[e,g]):(e.data={},e.data[a]=b,d.resolveWith(e,[e]))}var a=c.get("pagination.paginated_key"),b=[],f=2;(function h(c){return c.flag||(c.flag=!0,d.notifyWith(c,arguments),b=c.get(a).slice().concat(b)),c.prev().then(h,g)})(c),function i(c){return c.flag||(c.flag=!0,d.notifyWith(c,arguments),b=b.concat(c.get(a))),c.next().then(i,g)}(c)}var c=this,d=f.deferred(),e=new j({deferred:d});return this.fetched()?g():this.fetch().always(g),e.then(a,b)}},g={API_DOMAIN:"http://lanyrd.asyncjs.com",conference:function(a){return this.resource({url:this.url(a)})},person:function(a){var b=this.url(a).replace(/\/profile\//i,"/people/");return this.resource({url:b})},place:function(a){return this.resource({url:this.url(a)})},topic:function(a){return this.resource({url:this.url(a)})},collection:function(a){return new i(a)},resource:function(a){return new j(a)},url:function(a){return this.API_DOMAIN+f.pathname(a)},config:function(a){f.extend(e,a)},utils:f,noConflict:function(){return c.lanyrd=a,g},Collection:i,Resource:j},e={requestType:f.request.JSONP},typeof c.define=="function"&&c.define.amd?c.define("lanyrd",function(){return g}):c.exports?(require("./lanyrd/deferred")(f),require("./lanyrd/request")(f),h=require("url").parse,g.utils.pathname=function(a){return h(a).pathname},e.requestType=f.request.JSON,c.exports=g):c.lanyrd=g})(this.lanyrd,this.jQuery,typeof module!="undefined"?module:this);