(function(a){function f(a,b){for(var c=0,d=a.length;c<d;c+=1)return a[c]===b?!0:!1}var b=a.utils,c=["staff","speakers","attendees","trackers"],d={staff:4,speakers:4,attendees:2,trackers:1},e=0;a.mergeRelated=function(a,g){function k(){var a=[],c=b.keys(j);return b.each(arguments,function(d){var e=b.map(c,function(a){return d[0].collection("conference").related(a).fetch().pipe(function(a){return a.get(a.get("pagination.paginated_key"))})});a=a.concat(e)}),b.when.apply(null,a).pipe(function(){var a=[],d={};return b.each(arguments,function(f,g){var h=g%c.length;d[c[h]]=b.map(f,function(a){return a.user?a.user:(delete a.user,a.username||(a.username="user-"+(e+=1)),a)}),h===c.length-1&&(a.push(d),d={})}),a})}function l(a){function k(a,b){return g.duplicateAttendee!==!1&&a==="attendees"&&f(b,d[a])}function l(a,b){var c=h[b.username];c||(c=h[b.username]=b),d[a]||(d[a]=[]);if(!e[c.username]||k(a,c))d[a].push(c),e[c.username]=a;c.score=c.score||0,c.score+=j[a]}var d={},e={},h={};return b.each(c,function(c){j[c]&&b.each(a,function(a){var d=a[c];b.each(d,function(a){l(c,a)})})}),b.invoke(d,"sort",i),d}var h,i,j;return g=g||{},h=b.map(a,function(a){return a.fetch()}),j=g.related||d,b.isArray(g.related)&&(j={},b.each(g.related,function(a){j[a]=d[a]})),i=g.comparator||function(a,b){return a.score===b.score?a.username>b.username?1:-1:a.score>b.score?-1:1},b.when.apply(null,h).pipe(k).pipe(l)}})(this.lanyrd);