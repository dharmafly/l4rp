/*
    Lanyrd widget. An extension on top of the Lanyrd API
 *  Copyright 2011-2012, Dharmafly <http://dharmafly.com> 
 *  Released under the MIT License 
    https://github.com/dharmafly/lanyrd.js
*/
(function(){"use strict",lanyrd.widget={};var a=function(){var a=/{{\s*([a-z0-9_][\\.a-z0-9_]*)\s*}}/gi;return function(b,c){return b.replace(a,function(a,b){for(var d=b.split("."),e=d.length,f=c,h=0;h<e;h++){f=f[d[h]];if(f===void 0)throw"tim: '"+d[h]+"' not found in "+a;if(h===e-1)return f}})}}();lanyrd.widget.people=function(b,c,d){function g(a){return d.all?lanyrd.utils.when(a.related("conference.attendees").all(),a.related("conference.trackers").all()):lanyrd.utils.when(a.related("conference.attendees").fetch(),a.related("conference.trackers").fetch())}function h(a){c&&(d.append?c.innerHTML+=a:c.innerHTML=a)}function i(b,c){function i(b,c){var e=d.peopleTemplate||'<ul class="lanyrd-people {{peopleType}}">{{list}}</ul>',f=d.personTemplate||'<li><a href="{{web_url}}"><img class="lanyrd-avatar" title="{{name}} ({{username}})" src="{{avatar_url}}"></a></li>',g="",i,j=0;for(j;j<b.length;j++)i=b[j].user||b[j],g+=a(f,i);h+=a(e,{list:g,peopleType:c})}var e=lanyrd.utils.deferred(),g=e.promise(),h="";return h+="<h"+d.headingLevel+' class="lanyrd-attendees-title">'+b.length+" attending</h"+d.headingLevel+">",i(b,"lanyrd-attendees"),f&&(h+=a('<p><a target="_blank" href={{web_url}}attendees/>&rarr; Attendee details</a></p>',f)),c.length>0&&(h+="<h"+d.headingLevel+' class="lanyrd-trackers-title">'+c.length+" tracking</h"+d.headingLevel+">",i(c,"lanyrd-trackers")),h='<div class="lanyrd-widget"><style>.lanyrd-people, .lanyrd-people li  {padding: 0;margin: 0;}.lanyrd-people, .lanyrd-people li { overflow: hidden;}.lanyrd-people li {list-style: none;float: left;padding-right: 6px;}</style>'+h+"</div>",e.resolve(h),g}var e,f,d=d||{};return d.all=d.all||!0,d.headingLevel=d.headingLevel||2,lanyrd.utils.isArray(b)&&b.length>1?(b=lanyrd.utils.map(b,function(a){return lanyrd.conference(a).fetch()}),e=lanyrd.mergeRelated(b,{related:["attendees","trackers"]}).pipe(function(a){return i(a.attendees,a.trackers).then(h)})):(b+="",e=lanyrd.conference(b).fetch().pipe(function(a){return f=a.get("conference"),a}).pipe(g).pipe(function(a,b){return i(a.get("attendees"),b.get("trackers")).then(h)})),e},lanyrd.widget.person=function(b,c,d){function f(b){var c=lanyrd.utils.deferred(),e=c.promise(),f,g=d.personTemplate||'<h2><a href="{{web_url}}">{{name}}</a></h2><img class="lanyrd-avatar" title="{{name}} ({{username}})" src="{{avatar_url}}"><p>{{short_bio}}</p>';return f=a(g,b),c.resolve(f),e}var e,d=d||{};return e=lanyrd.person(b).fetch().pipe(function(a){return a.get("user")}).pipe(function(a){return f(a).then(function(a){c&&(c.innerHTML=a)})}),e}})()
